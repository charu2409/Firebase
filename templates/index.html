<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Dashboard</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; display: flex; height: 100vh; }
    .sidebar {
      width: 60px; background-color: #2D6A77; color: white; display: flex; flex-direction: column;
      align-items: center; padding: 20px 0;
    }
    .sidebar i { font-size: 24px; margin: 20px 0; cursor: pointer; }
    .sidebar i:hover { color: #72C2C4; }
    .main { flex: 1; padding: 20px; background-color: #F9FBFB; }
    .header { font-size: 24px; margin-bottom: 20px; color: #2D6A77; }
    .search-bar { margin-bottom: 20px; }
    .search-bar input { padding: 8px; width: 200px; }
    .search-bar button {
      padding: 8px 12px; background-color: #72C2C4; border: none; color: white; cursor: pointer;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
    tr:nth-child(even) { background-color: #E8F1F2; }
    tr:hover { background-color: #D3E8EA; }
    .icon-btn { cursor: pointer; margin: 0 5px; color: #2D6A77; }
    .icon-btn:hover { color: #72C2C4; }
    .form-section { margin-top: 20px; padding: 10px; background: #fff; border: 1px solid #ddd; }
    .form-section input { margin: 5px 0; padding: 8px; width: 100%; box-sizing: border-box; }
    .form-section button { padding: 8px 12px; background-color: #72C2C4; border: none; color: white; cursor: pointer; }
    .hidden { display: none; }
  </style>
</head>
<body>

  <div class="sidebar">
    <div class="logo">ðŸŒ¤</div>
    <i id="homeView" class="fas fa-home" title="Home"></i>
    <i id="addView" class="fas fa-plus" title="Add City"></i>
  </div>

  <div class="main">
    <div class="header">Weather Dashboard</div>
    
    <div id="searchSection" class="search-bar">
      <input type="text" id="searchCity" placeholder="Search by city">
      <button id="searchBtn">Search</button>
    </div>

    <div id="tableSection">
      <table id="cityTable">
        <thead>
          <tr>
            <th>City</th><th>Air Quality</th><th>Humidity</th><th>Status</th><th>Temperature</th><th>Operations</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="formSection" class="form-section hidden">
      <h3>Add / Edit City</h3>
      <input type="text" id="city" placeholder="City" required>
      <input type="text" id="air_quality" placeholder="Air Quality">
      <input type="text" id="humidity" placeholder="Humidity">
      <input type="text" id="status" placeholder="Status">
      <input type="text" id="temperature" placeholder="Temperature">
      <button id="submitBtn">Submit</button>
      <button id="cancelBtn" style="background:#aaa; margin-left:10px;">Cancel</button>
    </div>
  </div>

<script>
const API_BASE = "";  // relative path â†’ works both locally and deployed

// UI Elements
const homeView = document.getElementById("homeView");
const addView = document.getElementById("addView");
const searchSection = document.getElementById("searchSection");
const tableSection = document.getElementById("tableSection");
const formSection = document.getElementById("formSection");
const cityTableBody = document.querySelector("#cityTable tbody");

const searchCity = document.getElementById("searchCity");
const searchBtn = document.getElementById("searchBtn");

const formFields = {
  city: document.getElementById("city"),
  air_quality: document.getElementById("air_quality"),
  humidity: document.getElementById("humidity"),
  status: document.getElementById("status"),
  temperature: document.getElementById("temperature")
};
const submitBtn = document.getElementById("submitBtn");
const cancelBtn = document.getElementById("cancelBtn");

let editMode = false;

// Load all cities
async function loadCities() {
  const res = await fetch(`${API_BASE}/cities`);
  const data = await res.json();
  if (res.ok) renderRows(data);
  else cityTableBody.innerHTML = "<tr><td colspan='6'>No cities found</td></tr>";
}

// Render Table Rows
function renderRows(cities) {
  cityTableBody.innerHTML = "";
  cities.forEach(c => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${c.city}</td>
      <td>${c.air_quality || ""}</td>
      <td>${c.humidity || ""}</td>
      <td>${c.status || ""}</td>
      <td>${c.temperature || ""}</td>
      <td>
        <i class="fas fa-edit icon-btn" onclick="editCity('${c.city}')"></i>
        <i class="fas fa-trash icon-btn" onclick="deleteCity('${c.city}')"></i>
      </td>
    `;
    cityTableBody.appendChild(row);
  });
}

// View toggles
homeView.onclick = () => {
  searchSection.classList.remove("hidden");
  tableSection.classList.remove("hidden");
  formSection.classList.add("hidden");
  loadCities();
};
addView.onclick = () => {
  searchSection.classList.add("hidden");
  tableSection.classList.add("hidden");
  formSection.classList.remove("hidden");
  editMode = false;
  submitBtn.textContent = "Add City";
  Object.values(formFields).forEach(input => input.value = "");
};

// Search
searchBtn.onclick = async () => {
  const city = searchCity.value.trim();
  if (!city) return alert("Enter city name.");
  const res = await fetch(`${API_BASE}/city/${city}`);
  const data = await res.json();
  cityTableBody.innerHTML = "";
  if (res.ok) renderRows([data]);
  else alert(data.error || "City not found.");
};

// Edit
window.editCity = city => {
  editMode = true;
  submitBtn.textContent = "Update City";
  formSection.classList.remove("hidden");
  searchSection.classList.add("hidden");
  tableSection.classList.add("hidden");
  fetch(`${API_BASE}/city/${city}`).then(r => r.json()).then(data => {
    Object.keys(formFields).forEach(key => {
      formFields[key].value = data[key] || "";
    });
  });
};

// Delete
window.deleteCity = city => {
  if (!confirm(`Delete city "${city}"?`)) return;
  fetch(`${API_BASE}/delete-city`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ city })
  }).then(res => res.json())
    .then(data => {
      alert(data.message || data.error);
      loadCities();
    });
};

// Submit (Add / Update)
submitBtn.onclick = () => {
  const payload = {};
  Object.keys(formFields).forEach(key => {
    if (formFields[key].value.trim()) payload[key] = formFields[key].value.trim();
  });
  if (!payload.city) return alert("City is required.");

  const url = editMode ? `${API_BASE}/update-city` : `${API_BASE}/city`;
  const method = editMode ? "PUT" : "POST";

  fetch(url, {
    method,
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  })
  .then(async res => {
    const data = await res.json();
    alert(data.message || data.error);
    editMode = false;
    homeView.click();
  });
};

// Cancel
cancelBtn.onclick = () => homeView.click();

// Initial load
loadCities();
</script>

</body>
</html>
